{% extends 'web/base.html' %}

{% block content %}
<h1>Doctor-Patient Mappings</h1>

{% if messages %}
    <div class="messages">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
    </div>
{% endif %}

<table>
    <thead>
        <tr>
            <th>Patient</th>
            <th>Doctor</th>
            <th>Assigned By</th>
            <th>Assigned At</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for mapping in mappings %}
        <tr>
            <td><a href="{% url 'patient-detail' mapping.patient.id %}">{{ mapping.patient.name }}</a></td>
            <td><a href="{% url 'doctor-detail' mapping.doctor.id %}">{{ mapping.doctor.name }}</a></td>
            <td>{{ mapping.assigned_by.username }}</td>
            <td>{{ mapping.assigned_at|date:"F d, Y" }}</td>
            <td>
                <a href="{% url 'delete-mapping' mapping.id %}" onclick="return confirm('Are you sure you want to delete this mapping?');">Delete</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5">No mappings found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<p><a href="{% url 'create-mapping' %}">Assign a Doctor to a Patient</a></p>

<script>
    // Check if user is logged in
    document.addEventListener('DOMContentLoaded', function() {
        const token = localStorage.getItem('access_token');
        if (!token) {
            window.location.href = '{% url "login" %}';
        }
    });
</script>
{% endblock %}
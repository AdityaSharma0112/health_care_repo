{% extends 'web/base.html' %}

{% block content %}
<h1>Patient Details</h1>

{% if messages %}
    <div class="messages">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
    </div>
{% endif %}

<form method="post">
    {% csrf_token %}
    <div>
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" value="{{ patient.name }}" required>
    </div>
    <div>
        <label for="age">Age:</label>
        <input type="number" id="age" name="age" value="{{ patient.age }}" required>
    </div>
    <div>
        <label for="gender">Gender:</label>
        <select id="gender" name="gender" required>
            <option value="Male" {% if patient.gender == 'Male' %}selected{% endif %}>Male</option>
            <option value="Female" {% if patient.gender == 'Female' %}selected{% endif %}>Female</option>
            <option value="Other" {% if patient.gender == 'Other' %}selected{% endif %}>Other</option>
        </select>
    </div>
    <div>
        <label for="contact">Contact:</label>
        <input type="text" id="contact" name="contact" value="{{ patient.contact }}" required>
    </div>
    <button type="submit">Update Patient</button>
</form>

<p>
    <a href="{% url 'delete-patient' patient.id %}" onclick="return confirm('Are you sure you want to delete this patient?');">Delete Patient</a>
    | <a href="{% url 'patients-list' %}">Back to Patients List</a>
</p>

<h2>Assigned Doctors</h2>
<table>
    <thead>
        <tr>
            <th>Doctor Name</th>
            <th>Specialization</th>
            <th>Contact</th>
            <th>Email</th>
        </tr>
    </thead>
    <tbody>
        {% for mapping in patient.doctor_mappings.all %}
        <tr>
            <td><a href="{% url 'doctor-detail' mapping.doctor.id %}">{{ mapping.doctor.name }}</a></td>
            <td>{{ mapping.doctor.specialization }}</td>
            <td>{{ mapping.doctor.contact }}</td>
            <td>{{ mapping.doctor.email }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">No doctors assigned to this patient.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    // Check if user is logged in
    document.addEventListener('DOMContentLoaded', function() {
        const token = localStorage.getItem('access_token');
        if (!token) {
            window.location.href = '{% url "login" %}';
        }
    });
</script>
{% endblock %}
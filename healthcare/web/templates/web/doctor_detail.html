{% extends 'web/base.html' %}

{% block content %}
<h1>Doctor Details</h1>

{% if messages %}
    <div class="messages">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
    </div>
{% endif %}

<form method="post">
    {% csrf_token %}
    <div>
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" value="{{ doctor.name }}" required>
    </div>
    <div>
        <label for="specialization">Specialization:</label>
        <input type="text" id="specialization" name="specialization" value="{{ doctor.specialization }}" required>
    </div>
    <div>
        <label for="contact">Contact:</label>
        <input type="text" id="contact" name="contact" value="{{ doctor.contact }}" required>
    </div>
    <div>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" value="{{ doctor.email }}" required>
    </div>
    <button type="submit">Update Doctor</button>
</form>

<p>
    <a href="{% url 'delete-doctor' doctor.id %}" onclick="return confirm('Are you sure you want to delete this doctor?');">Delete Doctor</a>
    | <a href="{% url 'doctors-list' %}">Back to Doctors List</a>
</p>

<h2>Assigned Patients</h2>
<table>
    <thead>
        <tr>
            <th>Patient Name</th>
            <th>Age</th>
            <th>Gender</th>
            <th>Contact</th>
        </tr>
    </thead>
    <tbody>
        {% for mapping in doctor.patient_mappings.all %}
        <tr>
            <td><a href="{% url 'patient-detail' mapping.patient.id %}">{{ mapping.patient.name }}</a></td>
            <td>{{ mapping.patient.age }}</td>
            <td>{{ mapping.patient.gender }}</td>
            <td>{{ mapping.patient.contact }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">No patients assigned to this doctor.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    // Check if user is logged in
    document.addEventListener('DOMContentLoaded', function() {
        const token = localStorage.getItem('access_token');
        if (!token) {
            window.location.href = '{% url "login" %}';
        }
    });
</script>
{% endblock %}